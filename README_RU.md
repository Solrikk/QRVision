<div align="center"> <h3> <a href="https://github.com/Solrikk/QRVision/blob/main/README.md">English</a> | <a href="https://github.com/Solrikk/QRVision/blob/main/README_RU.md">⭐Russian⭐</a> | <a href="https://github.com/Solrikk/QRVision/blob/main/README_GE.md">German</a> | <a href="https://github.com/Solrikk/QRVision/blob/main/README_JP.md">Japanese</a> | <a href="README_KR.md">Korean</a> | <a href="README_CN.md">Chinese</a> </h3> </div>

-----------------

**`QRVision`** — представляет собой веб-сервис для сканирования QR-кодов, где фронтенд взаимодействует с оператором для захвата изображения через камеру, а бэкенд обрабатывает это изображение и пытается извлечь данные из QR-кодов в базу данных.

## Основные компоненты

### _Стек технологий:_

### _Backend:_

- **`Python`**: Основной язык программирования, используемый для реализации серверной части проекта.
- **`Flask`**: Легковесный, но мощный веб-фреймворк, который используется для создания и развертывания веб-приложений. Flask предоставляет все необходимые инструменты и библиотеки для формирования функциональности серверной части, работая по принципу расширяемости.
- **`OpenCV`**: Библиотека компьютерного зрения, применяемая для обработки изображений. Мы используем ее для выполнения различных операций преобразования изображений, что способствует улучшению распознавания QR-кодов, включая фильтрацию шума и коррекцию искажений.
- **`pyzbar`**: Специализированная библиотека для декодирования QR-кодов. Она обеспечивает точное и быстрое считывание информации из QR-кодов, что является критически важным.
- **`scikit-learn`**: Одна из ведущих библиотек машинного обучения, применяемая для разносторонней обработки данных. В нашем проекте она используется для анализа текста с помощью алгоритма TF-IDF (Term Frequency-Inverse Document Frequency), что позволяет эффективно анализировать и классифицировать текстовые данные.
- **`numpy`**: Высокопроизводительная библиотека для численных вычислений, которая работает с многомерными массивами и матрицами. Библиотека обеспечивает множество математических функций, что делает её незаменимой для обработки данных и выполнения сложных вычислений.
- **`SQLAlchemy`**: Объектно-реляционное отображение (ORM), упрощает взаимодействие с базой данных. SQLAlchemy позволяет абстрагироваться от деталей SQL-запросов, предоставляя удобный способ работы с базой данных через объектно-ориентированный интерфейс.
- **`PostgreSQL`**: Мощная и масштабируемая система управления базами данных (СУБД). Используется PostgreSQL для надежного хранения QR-кодов и связанных данных, что обеспечивает высокую производительность и безопасность данных.

### _Frontend:_

- **`HTML`**: Язык разметки, используемый для создания структуры веб-страницы. С его помощью можно определить различные элементы страницы, такие как заголовки, абзацы, формы и кнопки.
- **`CSS`**: Язык стилей, который используется для оформления HTML-элементов. С его помощью можно задать цвет, шрифты, размеры, отступы и другие визуальные характеристики элементов веб-страницы.
- **`JavaScript`**: Язык программирования, который используется для добавления интерактивности на веб-страницу. В этом проекте он необходим для управления взаимодействием с оператором, например, для захвата изображения с камеры и его отправки на сервер.

### _Дополнительные зависимости:_

- **`Poetry`**: Инструмент для управления зависимостями и создания изолированных виртуальных окружений в Python. Poetry упрощает установку и обновление пакетов, а также управление версиями, обеспечивая согласованность и воспроизводимость окружений.
- **`pyright`**: Быстрый и мощный статический анализатор типов для Python, который помогает выявлять ошибки типов еще до выполнения кода, тем самым повышая надежность и качество программного обеспечения.
- **`ruff`**: Линтер, предназначенный для улучшения качества кода и соблюдения стиля. Ruff помогает обнаруживать и исправлять стилистические ошибки, обеспечивая единообразие и чистоту кода согласно заданным стандартам.

### _Deployment:_

- **`Gunicorn`**: Высокопроизводительный WSGI HTTP сервер для запуска Flask-приложений в производственной среде. Gunicorn обеспечивает масштабируемость и надежность вашего веб-приложения, позволяя справляться с большим количеством одновременных запросов и обеспечивая стабильную работу сервиса.

### _Файловая структура:_

```shell
/app
├── .replit
├── static
│   ├── script.js
│   └── styles.css
├── main.py
├── pyproject.toml
├── templates
│   └── index.html
├── ...
├── replit.nix
├── models.py
```
_Эта структура проекта организует код и ресурсы логичным образом, упрощая разработку и поддержку приложения._

- **`main.py`**: Основной backend файл, содержаший Flask маршруты и логику обработки изображений и QR-кодов.
- **`templates/index.html`**: HTML-шаблон для главной страницы приложения.
- **`pyproject.toml`**: Файл конфигурации для управления зависимостями проекта и настройки релевации кода (Pyright и Ruff).
________

  - **OpenCV (Open Source Computer Vision Library)** — используется для выполнения различных задач, связанных с обработкой изображений и распознаванием QR-кодов. OpenCV является мощным инструментом для компьютерного зрения и обработки изображений, предоставляющим широкий спектр функций и модулей, включая фильтрацию, преобразование формы, распознавание объектов и многое другое. Благодаря богатому набору возможностей, OpenCV позволяет эффективно обрабатывать изображения для улучшения качества сканирования и точности распознавания QR-кодов.
_Пример работы OpenCV_
<img src="https://pbs.twimg.com/media/C2iLN6iW8AEbk5D.jpg:large">

## _Процесс сканирования QR-кодов:_

1. При загрузке страницы запускается скрипт, который запрашивает доступ к веб-камере пользователя:

```javascript
navigator.mediaDevices.getUserMedia({ video: { width: 1280, height: 720 } })
    .then(stream => {
        video.srcObject = stream;
    })
    .catch(err => {
        console.error("Ошибка доступа к камере: ", err);
    });
```

2. Видеопоток с веб-камеры отображается внутри элемента **`<video>`**, предоставляя пользователю возможность проверить корректность ракурса и положения QR-кода перед сканированием. Этот элемент находится в центре страницы для удобства пользователя.

3. Оператор нажимает кнопку "Сканировать QR-код". Это действие инициирует захват текущего изображения с веб-камеры и его отрисовку на элементе **`<canvas>`**:

```javascript
captureBtn.addEventListener('click', () => {
    setTimeout(() => {
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.style.display = 'block';
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
```

4. После рисования изображения на элементе <canvas>, оно конвертируется в **`Blob-формат`** и отправляется на серверный эндпоинт **`/scan-qr/`** с помощью **`Fetch API`**:
```javascript
    canvas.toBlob((blob) => {
        const formData = new FormData();
        formData.append('file', blob, 'capture.png');

        fetch('/scan-qr/', {
            method: 'POST',
            body: formData
        })
```
5. На сервере Flask обрабатывает этот запрос в эндпоинте **`/scan-qr/`**. Изображение сначала считывается и преобразуется в объект **`Pillow (PIL)`**:

```python
file = request.files['file']
contents = file.read()
image = Image.open(io.BytesIO(contents))
image_np = np.array(image)
```

6. Сервер производит серию предобработок на изображении для улучшения качества чтения QR-кодов. Предобработка выполняется функцией **`preprocess_image`** в нескольких попыток:

```python
attempts = 12
decoded_objects = []
for attempt in range(attempts):
    processed_image = preprocess_image(image_np, attempt)
    decoded_objects = decode(Image.fromarray(processed_image))
    if decoded_objects:
        break
```
7. Библиотека **`pyzbar`** используется для распознавания и декодирования QR-кодов на предобработанных изображениях:

```python
if decoded_objects:
    qr_data_list = []
    image_draw = ImageDraw.Draw(image)
    for obj in decoded_objects:
        qr_data = obj.data.decode('utf-8')
        qr_data_list.append(qr_data)
```
8. Декодированные данные QR-кода сохраняются в базу данных при помощи **`SQLAlchemy`**:

```python
        qr_data_entry = QRData(data=qr_data)
        db_session.add(qr_data_entry)
        db_session.commit()
```

9. Сервер создает метки на исходном изображении для отображения местоположения QR-кодов, используя **`OpenCV`**:

```python
        points = obj.polygon
        if len(points) == 4:
            pts = np.array(points, dtype=np.int32)
            cv2.polylines(image_np, [pts], isClosed=True, color=(0, 255, 0), thickness=2)
            text_position = (points[0].x, points[0].y - 10)
            image_draw.text(text_position, f"QR", fill=(255, 0, 0))
```

10. На клиентской стороне отображается **`alert`** с результатами сканирования QR-кодов:

```javascript
.then((data) => {
        alert('Данные QR-кода: ' + data.data);
        canvas.style.display = 'none';
    })
    .catch(error => {
        console.error('Ошибка:', error);
        canvas.style.display = 'none';
    });
```

## Процесс сканирования QR-кодов:

### 7. **База данных:**
Для хранения данных используем PostgreSQL, СУБД, которая позволяет надежно хранить данные и легко масштабироваться.
 - SQLAlchemy ORM используется для взаимодействия с базой данных. Он упрощает работу с данными и позволяет писать код, независимый от конкретной СУБД.
 - Модели определяются в `models.py`. Они представляют собой схемы таблиц базы данных и позволяют взаимодействовать с данными через классы Python.

**`PostgreSQL`** — это мощная, объектно-реляционная база данных с открытым исходным кодом (ORDBMS). Она поддерживает множество современных функций и стандартов SQL.

_**Основные характеристики PostgreSQL:**_

1. **Открытый исходный код**: PostgreSQL распространяется под лицензией PostgreSQL, которая позволяет свободно использовать, изменять и распространять базу данных.

2. **Совместимость со стандартами**: PostgreSQL поддерживает полный набор функций стандарта SQL и добавляет дополнительные возможности, такие как индексирование полнотекстового поиска, массивы, таблицы с наследованием и др.

3. **Расширяемость**: PostgreSQL может быть легко расширена за счет Операторских функций, агрегатов, типов данных и операторов.

4. **Продвинутое управление транзакциями**: PostgreSQL поддерживает ACID (Atomicity, Consistency, Isolation, Durability), обеспечение высокой надежности данных.

5. **Поддержка JSON**: PostgreSQL имеет мощные встроенные функции для работы с JSON и JSONB, что делает его подходящим для хранения гибких и сложных документов.

6.**Масштабируемость и производительность**: PostgreSQL поддерживает широкий диапазон функций, которые позволяют масштабировать и оптимизировать производительность, включая индексы, репликацию, шардинг (разделение данных) и параллельное выполнение запросов.
